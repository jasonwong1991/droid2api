# å®‰å…¨æ”¹è¿›æ–‡æ¡£

## å·²å®æ–½çš„å…³é”®ä¿®å¤ âœ…

### 1. è‡ªåŠ¨ç‰ˆæœ¬æ›´æ–°ç³»ç»Ÿ (version-updater.js)

**é—®é¢˜**: ç¡¬ç¼–ç çš„ `user_agent: "factory-cli/0.22.2"` å¯¼è‡´æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨ç›¸åŒç‰ˆæœ¬å·

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»º `version-updater.js` æ¨¡å—ï¼Œè‡ªåŠ¨ä»å®˜æ–¹å®‰è£…è„šæœ¬è·å–æœ€æ–°ç‰ˆæœ¬
- å¯åŠ¨æ—¶è‡ªåŠ¨è·å–ç‰ˆæœ¬å·
- æ¯24å°æ—¶è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡
- ä½¿ç”¨æœ¬åœ°ç¼“å­˜ (`.version-cache.json`) é¿å…é¢‘ç¹è¯·æ±‚
- å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°ç¼“å­˜æˆ–é»˜è®¤ç‰ˆæœ¬

**å®ç°ç»†èŠ‚**:
```javascript
// ä» https://app.factory.ai/cli è§£æç‰ˆæœ¬å·
// ç¼“å­˜åˆ° .version-cache.json
// æ¯24å°æ—¶è‡ªåŠ¨åˆ·æ–°
```

**æ•ˆæœ**:
- âœ… ç‰ˆæœ¬å·å§‹ç»ˆä¿æŒæœ€æ–°
- âœ… å‡å°‘è¢«è¯†åˆ«ä¸ºè¿‡æ—¶å®¢æˆ·ç«¯çš„é£é™©
- âœ… æ— éœ€æ‰‹åŠ¨æ›´æ–°é…ç½®

---

### 2. åŠ¨æ€ Client ID ç”Ÿæˆ (auth.js)

**é—®é¢˜**: ç¡¬ç¼–ç çš„ `client_01HNM792M5G5G1A2THWPXKFMXB` å¯¼è‡´æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä¸ª client_id

**è§£å†³æ–¹æ¡ˆ**:
- é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆå”¯ä¸€çš„ ULID æ ¼å¼ client_id
- ä¿å­˜åˆ° `~/.factory/auth.json` æˆ– `auth.json`
- åç»­è¿è¡Œå¤ç”¨åŒä¸€ä¸ª client_idï¼ˆæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼‰
- æ¯ä¸ªéƒ¨ç½²å®ä¾‹æ‹¥æœ‰ç‹¬ç«‹çš„ client_id

**å®ç°ç»†èŠ‚**:
```javascript
// 1. å°è¯•ä» auth æ–‡ä»¶åŠ è½½ client_id
// 2. å¦‚æœä¸å­˜åœ¨ï¼Œç”Ÿæˆæ–°çš„ ULID æ ¼å¼ ID
// 3. ä¿å­˜åˆ° auth æ–‡ä»¶ä¾›åç»­ä½¿ç”¨
// æ ¼å¼: client_01{26ä½ULID}
```

**æ•ˆæœ**:
- âœ… æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰å”¯ä¸€çš„ client_id
- âœ… é¿å…æ‰¹é‡ä»£ç†ç‰¹å¾
- âœ… æ¨¡æ‹ŸçœŸå®å®¢æˆ·ç«¯è¡Œä¸ºï¼ˆclient_id æŒä¹…åŒ–ï¼‰

---

## é£é™©ç­‰çº§å¯¹æ¯”

| é£é™©ç‚¹ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ç¨‹åº¦ |
|--------|--------|--------|----------|
| ç¡¬ç¼–ç  client_id | â­â­â­â­â­ | â­ | ğŸŸ¢ æ˜¾è‘—æ”¹å–„ |
| å›ºå®š User-Agent | â­â­â­â­â­ | â­â­ | ğŸŸ¢ æ˜¾è‘—æ”¹å–„ |
| ç‰ˆæœ¬å·è¿‡æ—¶ | â­â­â­â­ | â­ | ğŸŸ¢ æ˜¾è‘—æ”¹å–„ |

---

## ä½¿ç”¨è¯´æ˜

### é¦–æ¬¡å¯åŠ¨
```bash
npm start
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. ä»å®˜æ–¹è„šæœ¬è·å–æœ€æ–° factory-cli ç‰ˆæœ¬å·
2. ç”Ÿæˆå”¯ä¸€çš„ client_idï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
3. ä¿å­˜é…ç½®åˆ°æœ¬åœ°æ–‡ä»¶

### ç‰ˆæœ¬æ›´æ–°
- **è‡ªåŠ¨**: æ¯24å°æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°ç‰ˆæœ¬å·
- **æ‰‹åŠ¨**: åˆ é™¤ `.version-cache.json` åé‡å¯æœåŠ¡

### Client ID ç®¡ç†
- **ä½ç½®**: `~/.factory/auth.json` æˆ–é¡¹ç›®æ ¹ç›®å½• `auth.json`
- **æ ¼å¼**:
```json
{
  "client_id": "client_01JXXX...",
  "access_token": "...",
  "refresh_token": "..."
}
```
- **é‡ç½®**: åˆ é™¤ `client_id` å­—æ®µåé‡å¯ï¼Œç³»ç»Ÿä¼šç”Ÿæˆæ–°çš„

---

## æ–‡ä»¶è¯´æ˜

### æ–°å¢æ–‡ä»¶
- `version-updater.js` - ç‰ˆæœ¬è‡ªåŠ¨æ›´æ–°æ¨¡å—
- `.version-cache.json` - ç‰ˆæœ¬ç¼“å­˜ï¼ˆå·²åŠ å…¥ .gitignoreï¼‰

### ä¿®æ”¹æ–‡ä»¶
- `config.js` - æ·»åŠ  `getUserAgent()` å’Œ `getUserAgentSync()`
- `auth.js` - å®ç°åŠ¨æ€ client_id ç”Ÿæˆå’ŒæŒä¹…åŒ–
- `server.js` - å¯åŠ¨æ—¶åˆå§‹åŒ–ç‰ˆæœ¬æ›´æ–°å™¨
- `transformers/*.js` - ä½¿ç”¨ `getUserAgentSync()`
- `.gitignore` - å¿½ç•¥ç¼“å­˜æ–‡ä»¶

---

## å‰©ä½™é£é™©ç‚¹ï¼ˆå»ºè®®åç»­ä¼˜åŒ–ï¼‰

### ä¸­ç­‰é£é™© â­â­â­
1. **å›ºå®š SDK ç‰ˆæœ¬å·**
   - `x-stainless-package-version`: å›ºå®šä¸º 0.57.0 (Anthropic) / 5.23.2 (OpenAI)
   - å»ºè®®: å®ç°ç‰ˆæœ¬æ± æˆ–å®šæœŸæ›´æ–°

2. **å›ºå®šç³»ç»Ÿç¯å¢ƒ**
   - `x-stainless-os`: å›ºå®šä¸º MacOS
   - `x-stainless-arch`: å›ºå®šä¸º x64
   - å»ºè®®: å¯åŠ¨æ—¶éšæœºé€‰æ‹©ç¯å¢ƒå¹¶æŒä¹…åŒ–

3. **å›ºå®šåˆ·æ–°æ—¶é—´**
   - æ¯6å°æ—¶åˆ·æ–°ä»¤ç‰Œ
   - å»ºè®®: æ·»åŠ  Â±30åˆ†é’ŸéšæœºæŠ–åŠ¨

### ä½é£é™© â­â­
4. **Session ID é‡ç”¨**
   - æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–° UUID
   - å»ºè®®: å®ç° session ç¼“å­˜ï¼ˆ30åˆ†é’ŸTTLï¼‰

5. **å›ºå®š x-factory-client**
   - ç¡¬ç¼–ç ä¸º 'cli'
   - å»ºè®®: å°Šé‡å®¢æˆ·ç«¯æä¾›çš„å€¼

---

## ç›‘æ§å»ºè®®

### æ—¥å¿—å…³é”®å­—
```bash
# ç‰ˆæœ¬æ›´æ–°æˆåŠŸ
grep "Factory CLI version initialized" logs

# Client ID ç”Ÿæˆ
grep "Generated new client ID" logs

# ç‰ˆæœ¬è·å–å¤±è´¥
grep "Failed to fetch factory-cli version" logs
```

### å¥åº·æ£€æŸ¥
- æ£€æŸ¥ `.version-cache.json` æ˜¯å¦å®šæœŸæ›´æ–°
- æ£€æŸ¥ `auth.json` ä¸­æ˜¯å¦å­˜åœ¨ `client_id`
- ç›‘æ§ç‰ˆæœ¬å·æ˜¯å¦ä¸å®˜æ–¹æœ€æ–°ç‰ˆæœ¬ä¸€è‡´

---

## å›æ»šæ–¹æ¡ˆ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

### å›æ»šç‰ˆæœ¬æ›´æ–°å™¨
```bash
# åˆ é™¤ç‰ˆæœ¬æ›´æ–°å™¨
rm version-updater.js .version-cache.json

# æ¢å¤ config.js ä¸­çš„ getUserAgent()
# æ”¹å›: return cfg.user_agent || 'factory-cli/0.25.2';

# ç§»é™¤ server.js ä¸­çš„åˆå§‹åŒ–ä»£ç 
# åˆ é™¤: await initializeVersionUpdater();
```

### å›æ»šåŠ¨æ€ Client ID
```bash
# åœ¨ auth.js ä¸­æ¢å¤ç¡¬ç¼–ç 
clientId = 'client_01HNM792M5G5G1A2THWPXKFMXB';
```

---

## æµ‹è¯•éªŒè¯

### éªŒè¯ç‰ˆæœ¬æ›´æ–°
```bash
# å¯åŠ¨æœåŠ¡
npm start

# æ£€æŸ¥æ—¥å¿—
# åº”è¯¥çœ‹åˆ°: "Factory CLI version initialized: 0.25.2"

# æ£€æŸ¥ç¼“å­˜æ–‡ä»¶
cat .version-cache.json
```

### éªŒè¯ Client ID
```bash
# é¦–æ¬¡å¯åŠ¨åæ£€æŸ¥
cat ~/.factory/auth.json | grep client_id

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼: "client_id": "client_01JXXX..."
```

---

## æ€»ç»“

é€šè¿‡è¿™ä¸¤ä¸ªå…³é”®ä¿®å¤ï¼Œæˆ‘ä»¬æ˜¾è‘—é™ä½äº†è¢«è¯†åˆ«ä¸ºä»£ç†/æœºå™¨äººçš„é£é™©ï¼š

âœ… **å·²è§£å†³**:
- ç¡¬ç¼–ç  client_idï¼ˆæœ€é«˜é£é™©ï¼‰
- å›ºå®š User-Agent ç‰ˆæœ¬å·ï¼ˆæœ€é«˜é£é™©ï¼‰
- ç‰ˆæœ¬å·è¿‡æ—¶é—®é¢˜

âš ï¸ **å¾…ä¼˜åŒ–**:
- SDK ç‰ˆæœ¬å·æ± åŒ–
- ç³»ç»Ÿç¯å¢ƒéšæœºåŒ–
- åˆ·æ–°æ—¶é—´æŠ–åŠ¨
- Session ID ç¼“å­˜

ğŸ¯ **å»ºè®®**: å…ˆè§‚å¯Ÿå½“å‰ä¿®å¤çš„æ•ˆæœï¼Œå¦‚æœä»æœ‰å°å·é£é™©ï¼Œå†é€æ­¥å®æ–½å‰©ä½™ä¼˜åŒ–ã€‚
